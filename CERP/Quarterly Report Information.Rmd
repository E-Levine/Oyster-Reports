---
title: "Quarterly Report Information"
author: "ELevine"
date: "`r Sys.Date()`"
output: 
  html_document:
  word_document: NULL
params:
  Start_date: "2024-10-01"
  End_date: "2024-12-30"
---
<style>
.main-container {
    max-width: 9000px;
    margin-left: 20px;
    margin-right: auto;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
#
Start_date <- as.Date(params$Start_date)
End_date <- as.Date(params$End_date)

#Packages
if (!require("pacman")) {install.packages("pacman")}
#p_unlock()
pacman::p_load(odbc, DBI, dbplyr,
  tidyverse, dplyr,  stringr, #DF manipulation
  DT, openxlsx,         #Excel
  lubridate, zoo,         #Dates
  knitr, kableExtra, scales, gt, gtExtras,
  install = TRUE)
```

```{css}
p {
font-size: 12pt;
}

caption {
  color: black;
  font-weight: bold;
  font-size: 14;
  text-indent: 5%;
} 

h1 {
font-size: 21pt;
font-weight: bold;
}

h2 {
font-size: 17pt;
font-weight: bold;
}

h3 {
font-size: 13pt;
font-style: italic;
text-decoration: underline;
}

h4 {
  color: black;
  font-weight: bold;
  font-size: 17;
  text-indent: 5%;
}
```

```{r Data gather from summary file}
WQ_Sal_s <-  readWorkbook("WQ_Summary_Data.xlsx", sheet = 'Salinity Station', detectDates = TRUE, check.names = TRUE)
WQ_Secchi_s <-  readWorkbook("WQ_Summary_Data.xlsx", sheet = 'Secchi Station', detectDates = TRUE, check.names = TRUE)
Dermo_df <- readWorkbook("Summary_Data.xlsx", sheet = 'Dermo Station', detectDates = TRUE, check.names = TRUE)
Rcrt_df <- readWorkbook("Summary_Data.xlsx", sheet = 'Rcrt Station', detectDates = TRUE, check.names = TRUE)
Repro_df <- readWorkbook("Summary_Data.xlsx", sheet = 'Repro', detectDates = TRUE, check.names = TRUE)
Counts_df <- readWorkbook("Summary_Data.xlsx", sheet = 'DeadRatio Station', detectDates = TRUE, check.names = TRUE)
SH_df <- readWorkbook("Summary_Data.xlsx", sheet = 'SH Station', detectDates = TRUE, check.names = TRUE)
Cage_df <- readWorkbook("Summary_Data.xlsx", sheet = 'SH Mort Cage', detectDates = TRUE, check.names = TRUE)
Sedi_sta <- readWorkbook("Summary_Data.xlsx", sheet = 'Sedi Stations', detectDates = TRUE, check.names = TRUE)
Sedi_pos <- readWorkbook("Summary_Data.xlsx", sheet = 'Sedi Position', detectDates = TRUE, check.names = TRUE)
```

```{r Data selection and cleaning}
#
##Salinity
WQ_Sal_CERP <- WQ_Sal_s %>% dplyr::select(starts_with("SL"), starts_with("LX")) %>% subset(SL.C_RetDate_Sal > Start_date & SL.C_RetDate_Sal < End_date) %>% rename(RetDate = SL.C_RetDate_Sal) %>% dplyr::select(-SL.N_RetDate_Sal, -SL.S_RetDate_Sal, -LX.N_RetDate_Sal, -LX.S_RetDate_Sal) %>% mutate(RetDate = as.yearmon(RetDate))
WQ_Sal_CRE <- WQ_Sal_s %>% dplyr::select(starts_with("CR")) %>% subset(CR.E_RetDate_Sal > Start_date & CR.E_RetDate_Sal < End_date)  %>% rename(RetDate = CR.E_RetDate_Sal) %>% dplyr::select(-CR.W_RetDate_Sal)
WQ_Sal_PBC <- WQ_Sal_s %>% dplyr::select(starts_with("LW")) %>% subset(LW.L_RetDate_Sal > Start_date & LW.L_RetDate_Sal < End_date) %>% rename(RetDate = LW.L_RetDate_Sal) %>% dplyr::select(-LW.R_RetDate_Sal)
#
#Secchi
WQ_Sec_CERP <- WQ_Secchi_s %>% dplyr::select(starts_with("SL"), starts_with("LX")) %>% subset(SL.C_RetDate_SP > Start_date & SL.C_RetDate_SP < End_date) %>% rename(RetDate = SL.C_RetDate_SP) %>% dplyr::select(-SL.N_RetDate_SP, -SL.S_RetDate_SP, -LX.N_RetDate_SP, -LX.S_RetDate_SP) %>% mutate(RetDate = as.yearmon(RetDate))
WQ_Sec_CRE <- WQ_Secchi_s %>% dplyr::select(starts_with("CR")) %>% subset(CR.E_RetDate_SP > Start_date & CR.E_RetDate_SP < End_date)  %>% rename(RetDate = CR.E_RetDate_SP) %>% dplyr::select(-CR.W_RetDate_SP)
WQ_Sec_PBC <- WQ_Secchi_s %>% dplyr::select(starts_with("LW")) %>% subset(LW.L_RetDate_SP > Start_date & LW.L_RetDate_SP < End_date) %>% rename(RetDate = LW.L_RetDate_SP) %>% dplyr::select(-LW.R_RetDate_SP)
#
#Dermo
Dermo_CERP <- Dermo_df %>% dplyr::select(starts_with("SL"), starts_with("LX")) %>% dplyr::select(!contains("SD")) %>% subset(SL.C_RetDate > Start_date & SL.C_RetDate < End_date) %>% rename(RetDate = SL.C_RetDate) %>% dplyr::select(-SL.N_RetDate, -SL.S_RetDate, -LX.N_RetDate, -LX.S_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
Dermo_CRE <- Dermo_df %>% dplyr::select(starts_with("CR")) %>% dplyr::select(!contains("SD")) %>% subset(CR.E_RetDate > Start_date & CR.E_RetDate < End_date) %>% rename(RetDate = CR.E_RetDate) %>% dplyr::select(-CR.W_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
Dermo_PBC <- Dermo_df %>% dplyr::select(starts_with("LW")) %>% dplyr::select(!contains("SD")) %>% subset(LW.L_RetDate > Start_date & LW.L_RetDate < End_date) %>% rename(RetDate = LW.L_RetDate) %>% dplyr::select(-LW.R_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
#
#Rcrt
Rcrt_CERP <- Rcrt_df %>% dplyr::select(starts_with("SL"), starts_with("LX")) %>% dplyr::select(!contains("SD")) %>% subset(SL.C_RetDate > Start_date & SL.C_RetDate < End_date) %>% rename(RetDate = SL.C_RetDate) %>% dplyr::select(-SL.N_RetDate, -SL.S_RetDate, -LX.N_RetDate, -LX.S_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
Rcrt_CRE <- Rcrt_df %>% dplyr::select(starts_with("CR")) %>% dplyr::select(!contains("SD")) %>% subset(CR.E_RetDate > Start_date & CR.E_RetDate < End_date) %>% rename(RetDate = CR.E_RetDate) %>% dplyr::select(-CR.W_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
Rcrt_PBC <- Rcrt_df %>% dplyr::select(starts_with("LW")) %>% dplyr::select(!contains("SD")) %>% subset(LW.L_RetDate > Start_date & LW.L_RetDate < End_date) %>% rename(RetDate = LW.L_RetDate) %>% dplyr::select(-LW.R_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
#
#Repro
Repro_CERP <- Repro_df %>% dplyr::select(starts_with("SL"), starts_with("LX")) %>% subset(SL.C_RetDate > Start_date & SL.C_RetDate < End_date) %>% rename(RetDate = SL.C_RetDate) %>% dplyr::select(-SL.N_RetDate, -SL.S_RetDate, -LX.N_RetDate, -LX.S_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
Repro_CRE <- Repro_df %>% dplyr::select(starts_with("CR")) %>% subset(CR.E_RetDate > Start_date & CR.E_RetDate < End_date) %>% rename(RetDate = CR.E_RetDate) %>% dplyr::select(-CR.W_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
Repro_PBC <- Repro_df %>% dplyr::select(starts_with("LW")) %>% subset(LW.L_RetDate > Start_date & LW.L_RetDate < End_date) %>% rename(RetDate = LW.L_RetDate) %>% dplyr::select(-LW.R_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
#
##Survey counts
Counts_CERP <- Counts_df %>% dplyr::select(AnalysisDate, starts_with("SL"), starts_with("LX")) %>%  mutate(AnalysisDate = as.yearmon(AnalysisDate)) %>% subset(AnalysisDate > (as.yearmon(End_date %m-% months(7))) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% replace(is.na(.), -999)
Counts_CRE <- Counts_df %>% dplyr::select(AnalysisDate, starts_with("CR")) %>%  mutate(AnalysisDate = as.yearmon(AnalysisDate)) %>% subset(AnalysisDate > (as.yearmon(End_date %m-% months(7))) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% replace(is.na(.), -999)
Counts_PBC <- Counts_df %>% dplyr::select(AnalysisDate, starts_with("LW")) %>%  mutate(AnalysisDate = as.yearmon(AnalysisDate)) %>% subset(AnalysisDate > (as.yearmon(End_date %m-% months(7))) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% replace(is.na(.), -999)
#
##Survey SHs
SH_CERP <- SH_df %>% dplyr::select(AnalysisDate, starts_with("SL"), starts_with("LX")) %>%  mutate(AnalysisDate = as.yearmon(AnalysisDate)) %>% subset(AnalysisDate > (as.yearmon(End_date %m-% months(6))) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% replace(is.na(.), -999)
SH_CRE <- SH_df %>% dplyr::select(AnalysisDate, starts_with("CR")) %>%  mutate(AnalysisDate = as.yearmon(AnalysisDate)) %>% subset(AnalysisDate > (as.yearmon(End_date %m-% months(7))) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% replace(is.na(.), -999)
SH_PBC <- SH_df %>% dplyr::select(AnalysisDate, starts_with("LW")) %>%  mutate(AnalysisDate = as.yearmon(AnalysisDate)) %>% subset(AnalysisDate > (as.yearmon(End_date %m-% months(7))) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% replace(is.na(.), -999)
#
##Cages
Cage_CERP <- Cage_df %>% dplyr::select(starts_with("SL"), starts_with("LX")) %>% dplyr::select(!contains("SD")) %>% subset(SL.C_RetDate > Start_date & SL.C_RetDate < End_date) %>% rename(RetDate = SL.C_RetDate) %>% dplyr::select(-LX.N_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
Cage_CRE <- Cage_df %>% dplyr::select(starts_with("CR")) %>% dplyr::select(!contains("SD")) %>% subset(CR.E_RetDate > Start_date & CR.E_RetDate < End_date) %>% rename(RetDate = CR.E_RetDate) %>% dplyr::select(-CR.W_RetDate) %>% mutate(RetDate = as.yearmon(RetDate))
#
##Sediment
Rate_sta <- Sedi_sta %>% dplyr::select(AnalysisDate, contains("RateMean")) %>% subset(AnalysisDate >= Start_date & AnalysisDate < End_date)
Pct_sta <- Sedi_sta %>% dplyr::select(AnalysisDate, contains("OrganicMean")) %>% subset(AnalysisDate >= Start_date & AnalysisDate < End_date)
Wt_sta <- Sedi_sta %>% dplyr::select(AnalysisDate, contains("WtMean")) %>% subset(AnalysisDate >= Start_date & AnalysisDate < End_date)

Reef_type_summ <- Sedi_sta %>% subset(AnalysisDate >= Start_date & AnalysisDate < End_date) %>% dplyr::select(-contains("Ret"), -AnalysisDate) %>% gather("Info", Value) %>% mutate(Station = substr(Info, 1, 5), Measure = str_extract(Info, "(?<=_).*")) %>% dplyr::select(-Info) %>% filter(!grepl("SD", Measure)) %>% mutate(ReefType = case_when(grepl("LW.L", Station) ~ "Natural", grepl("LW.R", Station) ~ "Restoration"), Position = case_when(grepl(c("R4|L1|L2"), Station) ~ "North", grepl(c("R2|R3|L3"), Station) ~ "South"))# %>% group_by(Station, Measure) %>% summarise(Mean = mean(Value, na.rm = T)) %>% spread(Measure, Mean) #%>% mutate(across(everything(), round, digits = 2))

```

```{r table formatting}
#Salinity
CERP_Sal <- WQ_Sal_CERP %>% gt() %>% data_color(columns = contains("Sal"), fn = scales::col_numeric(palette = "plasma", domain = WQ_Sal_CERP %>% dplyr::select(contains("Sal")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 4, 7, 10, 13, 16), sides = "right", color = "black") %>% cols_label_with(fn = ~gsub("_Sal","", .)) %>% cols_align(align = c("center"), columns = everything())
#
CRE_Sal <- WQ_Sal_CRE %>% gt() %>% data_color(columns = contains("Sal"), fn = scales::col_numeric(palette = "plasma", domain = WQ_Sal_CRE %>% dplyr::select(contains("Sal")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 3), sides = "right", color = "black") %>% cols_label_with(fn = ~gsub("_Sal","", .)) %>% cols_align(align = c("center"), columns = everything())
#
PBC_Sal <- WQ_Sal_PBC %>% gt() %>% data_color(columns = contains("Sal"), fn = scales::col_numeric(palette = "plasma", domain = WQ_Sal_PBC %>% dplyr::select(contains("Sal")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 4), sides = "right", color = "black") %>% cols_label_with(fn = ~gsub("_Sal","", .)) %>% cols_align(align = c("center"), columns = everything())
#
#
##Secchi
CERP_Sec <- WQ_Sec_CERP %>% gt() %>% data_color(columns = contains("SP"), fn = scales::col_numeric(palette = "plasma", domain = WQ_Sec_CERP %>% dplyr::select(contains("SP")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 4, 7, 10, 13, 16), sides = "right", color = "black") %>% cols_label_with(fn = ~gsub("_SP","", .)) %>% cols_align(align = c("center"), columns = everything())
#
CRE_Sec <- WQ_Sec_CRE %>% gt() %>% data_color(columns = contains("SP"), fn = scales::col_numeric(palette = "plasma", domain = WQ_Sec_CRE %>% dplyr::select(contains("SP")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 3), sides = "right", color = "black") %>% cols_label_with(fn = ~gsub("_SP","", .)) %>% cols_align(align = c("center"), columns = everything())
#
PBC_Sec <- WQ_Sec_PBC %>% gt() %>% data_color(columns = contains("SP"), fn = scales::col_numeric(palette = "plasma", domain = WQ_Sec_PBC %>% dplyr::select(contains("SP")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 4), sides = "right", color = "black") %>% cols_label_with(fn = ~gsub("_SP","", .)) %>% cols_align(align = c("center"), columns = everything())
#
#
##Dermo
CERP_dermo <- Dermo_CERP %>% gt() %>% data_color(columns = contains("Pct"), fn = scales::col_numeric(palette = "plasma", domain = Dermo_CERP %>% dplyr::select(contains("Pct")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_Mean","", .)) %>% cols_label_with(fn = ~gsub("_Pct","", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29), sides = "right", color = "black") %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(container.width = 2000)
#
CRE_dermo <- Dermo_CRE %>% gt() %>% data_color(columns = contains("Pct"), fn = scales::col_numeric(palette = "plasma", domain = Dermo_CRE %>% dplyr::select(contains("Pct")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_Mean","", .)) %>% cols_label_with(fn = ~gsub("_Pct","", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7), sides = "right", color = "black") %>% cols_align(align = c("center"), columns = everything())
#
PBC_dermo <- Dermo_PBC %>% gt() %>% data_color(columns = contains("Pct"), fn = scales::col_numeric(palette = "plasma", domain = Dermo_PBC %>% dplyr::select(contains("Pct")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_Mean","", .)) %>% cols_label_with(fn = ~gsub("_Pct","", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7), sides = "right", color = "black") %>% cols_align(align = c("center"), columns = everything())
#
#
##Rcrt
CERP_rcrt <- Rcrt_CERP %>% gt() %>% data_color(columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Rcrt_CERP %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 4, 7, 10, 13), sides = "right", color = "black") %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(container.width = 1800)
#
CRE_rcrt <- Rcrt_CRE %>% gt() %>% data_color(columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Rcrt_CRE %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 3), sides = "right", color = "black") %>% cols_align(align = c("center"), columns = everything())
#
PBC_rcrt <- Rcrt_PBC %>% gt() %>% data_color(columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Rcrt_PBC %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% gt_add_divider(columns = c(1, 4), sides = "right", color = "black") %>% cols_align(align = c("center"), columns = everything())
#
#
##Repro
CERP_repro <- Repro_CERP %>% gather(Site, Pct, -RetDate) %>% mutate(Station = substr(Site, 1, 4), Stage = substr(Site, 6, 8)) %>% dplyr::select(-Site) %>% spread(Stage, Pct) %>% arrange(Station, RetDate) %>% gt(rowname_col = "RetDate", groupname_col = "Station") %>% data_color(direction = "row", method = "numeric", palette = c("plasma"), alpha = 0.8) %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(row_group.border.top.color = "black", row_group.border.bottom.color = "black", row_group.font.weight = "bold")
#
CRE_repro <- Repro_CRE %>% gather(Site, Pct, -RetDate) %>% mutate(Station = substr(Site, 1, 4), Stage = substr(Site, 6, 8)) %>% dplyr::select(-Site) %>% spread(Stage, Pct) %>% arrange(Station, RetDate) %>% gt(rowname_col = "RetDate", groupname_col = "Station") %>% data_color(direction = "row", method = "numeric", palette = c("plasma"), alpha = 0.8) %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(row_group.border.top.color = "black", row_group.border.bottom.color = "black", row_group.font.weight = "bold")
#
PBC_repro <- Repro_PBC %>% gather(Site, Pct, -RetDate) %>% mutate(Station = substr(Site, 1, 4), Stage = substr(Site, 6, 8)) %>% dplyr::select(-Site) %>% spread(Stage, Pct) %>% arrange(Station, RetDate) %>% gt(rowname_col = "RetDate", groupname_col = "Station") %>% data_color(direction = "row", method = "numeric", palette = c("plasma"), alpha = 0.8) %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(row_group.border.top.color = "black", row_group.border.bottom.color = "black", row_group.font.weight = "bold")
#
#
##Counts
CERP_count <- Counts_CERP %>% dplyr::select(AnalysisDate, contains("Live")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Counts_CERP %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% cols_label_with(fn = ~gsub("LiveMean","Mean", .)) %>% cols_label_with(fn = ~gsub("LiveSD","SD", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29), sides = "right", color = "black") %>% gt_split(col_slice_at = "SL.S3_LiveSD") %>% grp_options(container.width = 2000)
#
CRE_count <- Counts_CRE %>% dplyr::select(AnalysisDate, contains("Live")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Counts_CRE %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% cols_label_with(fn = ~gsub("LiveMean","Mean", .)) %>% cols_label_with(fn = ~gsub("LiveSD","SD", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7), sides = "right", color = "black")
#
PBC_count <- Counts_PBC %>% dplyr::select(AnalysisDate, contains("Live")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Counts_PBC %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% cols_label_with(fn = ~gsub("LiveMean","Mean", .)) %>% cols_label_with(fn = ~gsub("LiveSD","SD", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7, 9, 11, 13), sides = "right", color = "black") %>% tab_options(container.width = 1500)
#
#
##Dead Ratios
CERP_dead <- Counts_CERP %>% dplyr::select(AnalysisDate, contains("Dead")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Counts_CERP %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% cols_label_with(fn = ~gsub("DeadRatioMean","Mean", .)) %>% cols_label_with(fn = ~gsub("DeadRatioSD","SD", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29), sides = "right", color = "black") %>% gt_split(col_slice_at = "SL.S3_DeadRatioSD") %>% grp_options(container.width = 1500)
#
CRE_dead <- Counts_CRE %>% dplyr::select(AnalysisDate, contains("Dead")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Counts_CRE %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% cols_label_with(fn = ~gsub("DeadRatioMean","Mean", .)) %>% cols_label_with(fn = ~gsub("DeadRatioSD","SD", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7), sides = "right", color = "black")
#
PBC_dead <- Counts_PBC %>% dplyr::select(AnalysisDate, contains("Dead")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = Counts_PBC %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% cols_label_with(fn = ~gsub("DeadRatioMean","Mean", .)) %>% cols_label_with(fn = ~gsub("DeadRatioSD","SD", .)) %>% gt_add_divider(columns = c(1, 3, 5, 7, 9, 11, 13), sides = "right", color = "black") %>% tab_options(container.width = 1500)
#
#
##SHs
CERP_SH <- SH_CERP %>% dplyr::select(AnalysisDate, contains("Mean")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = SH_CERP %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% gt_add_divider(columns = c(1, 4, 7, 10, 13), sides = "right", color = "black") %>% gt_split(col_slice_at = "SL.S3_SHMean") %>% grp_options(container.width = 1500)
#
CRE_SH <- SH_CRE %>% dplyr::select(AnalysisDate, contains("Mean")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = SH_CRE %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% gt_add_divider(columns = c(1, 3), sides = "right", color = "black")
#
PBC_SH <- SH_PBC %>% dplyr::select(AnalysisDate, contains("Mean")) %>% gt() %>% data_color(rows = (AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))), columns = contains("Mean"), fn = scales::col_numeric(palette = "plasma", domain = SH_PBC %>% filter(AnalysisDate > as.yearmon(Start_date)) %>% dplyr::select(contains("Mean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>% gt_add_divider(columns = c(1, 4), sides = "right", color = "black") %>% tab_options(container.width = 1500)
#
#Summary table - PBC
PBC_survey_sum <- left_join(rbind(Counts_PBC %>% gather(Info, Value, -AnalysisDate) %>% mutate(Value = na_if(Value, -999), Station = str_remove(str_extract(Info, "^.{5}"), "\\."), Measure = substr(Info, 7, n())) %>% group_by(Station, Measure) %>% summarise(mean = round(mean(Value, na.rm = T), 2)) %>% spread(Measure, mean), Counts_PBC %>% gather(Info, Value, -AnalysisDate) %>% mutate(Value = na_if(Value, -999), Station = paste0(str_remove(str_extract(Info, "^.{4}"), "\\."),"_mean"), Measure = substr(Info, 7, n())) %>% group_by(Station, Measure) %>% summarise(mean = round(mean(Value, na.rm = T), 2)) %>% spread(Measure, mean)) %>% arrange(Station) %>% ungroup() %>% dplyr::select(Station, "Live density (oysters/m2)" = LiveMean, "Dead Ratio" = DeadRatioMean), 
      rbind(SH_PBC %>% gather(Info, Value, -AnalysisDate) %>% mutate(Value = na_if(Value, -999), Station = str_remove(str_extract(Info, "^.{5}"), "\\."), Measure = substr(Info, 7, n())) %>% group_by(Station, Measure) %>% summarise(mean = round(mean(Value, na.rm = T), 2)) %>% spread(Measure, mean), SH_PBC %>% gather(Info, Value, -AnalysisDate) %>% mutate(Value = na_if(Value, -999), Station = paste0(str_remove(str_extract(Info, "^.{4}"), "\\."), "_mean"), Measure = substr(Info, 7, n())) %>% group_by(Station, Measure) %>% summarise(mean = round(mean(Value, na.rm = T), 2)) %>% spread(Measure, mean)) %>% arrange(Station) %>% ungroup() %>% dplyr::select(Station, "Shell height (mm)" = SHMean)) %>% gt() %>% tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = c(4, 8))) %>% cols_align(align = c("center"), columns = everything()) %>%  gt_add_divider(columns = c(1, 2, 3), sides = "right", color = "black") %>% tab_style(style = cell_borders(sides = "top", color = "black"), locations = cells_body(rows = c(1, 5)))
#
#
#
##Cages
SL_Cage <- Cage_CERP %>% dplyr::select(RetDate, contains("SL")) %>% gt() %>% data_color(columns = contains("Pct"), fn = scales::col_numeric(palette = "plasma", domain = Cage_CERP %>% dplyr::select(RetDate, contains("SL")) %>% dplyr::select(contains("Pct")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_SHMean","", .)) %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(container.width = 1500)
#
LX_Cage <- Cage_CERP %>% dplyr::select(RetDate, contains("LX")) %>% gt() %>% data_color(columns = contains("Pct"), fn = scales::col_numeric(palette = "plasma", domain = Cage_CERP %>% dplyr::select(RetDate, contains("LX")) %>% dplyr::select(contains("Pct")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_SHMean","", .)) %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(container.width = 1500)
#
CRE_Cage <- Cage_CRE %>% dplyr::select(RetDate, contains("CR.E")) %>% gt() %>% data_color(columns = contains("Pct"), fn = scales::col_numeric(palette = "plasma", domain = Cage_CRE %>% dplyr::select(RetDate, contains("CR.E")) %>% dplyr::select(contains("Pct")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_SHMean","", .)) %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(container.width = 1500)
#
CRW_Cage <- Cage_CRE %>% dplyr::select(RetDate, contains("CR.W")) %>% gt() %>% data_color(columns = contains("Pct"), fn = scales::col_numeric(palette = "plasma", domain = Cage_CRE %>% dplyr::select(RetDate, contains("CR.W")) %>% dplyr::select(contains("Pct")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_SHMean","", .)) %>% cols_align(align = c("center"), columns = everything()) %>% tab_options(container.width = 1500)
#
#
##Sediment
Sta_Rates <- Rate_sta %>% replace(is.na(.), -25) %>% gt() %>% data_color(columns = contains("Rate"), fn = scales::col_numeric(palette = "plasma", domain = Rate_sta %>% replace(is.na(.), -25) %>% dplyr::select(contains("Rate")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_Rate","", .)) %>% cols_align(align = c("center"), columns = everything()) %>%  gt_add_divider(columns = c(1, 4), sides = "right", color = "black")
#
Sta_Pcts <- Pct_sta %>% replace(is.na(.), -12) %>% gt() %>% data_color(columns = contains("Organic"), fn = scales::col_numeric(palette = "plasma", domain = Pct_sta %>% replace(is.na(.), -12) %>% dplyr::select(contains("Organic")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_PctOrganic","", .)) %>% cols_align(align = c("center"), columns = everything()) %>%  gt_add_divider(columns = c(1, 4), sides = "right", color = "black")
#
Sta_Wts <- Wt_sta %>% replace(is.na(.), -1) %>% gt() %>% data_color(columns = contains("OrgWt"), fn = scales::col_numeric(palette = "plasma", domain = Wt_sta %>% replace(is.na(.), -1) %>% dplyr::select(contains("OrgWt")) %>% unlist() %>% range(na.rm = T))) %>% cols_label_with(fn = ~gsub("_OrgWt","", .)) %>% cols_align(align = c("center"), columns = everything()) %>%  gt_add_divider(columns = c(1, 4), sides = "right", color = "black")

Pos_Rates <- Sedi_pos %>% subset(AnalysisDate >= Start_date & AnalysisDate < End_date) %>% replace(is.na(.), -0.5) %>% dplyr::select(AnalysisDate, contains("RateMean")) %>% gt() %>% data_color(columns = contains("RateMean"), fn = scales::col_numeric(palette = "plasma", domain = Sedi_pos %>% replace(is.na(.), -0.5) %>% dplyr::select(contains("Rate")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>%  gt_add_divider(columns = c(1, 3), sides = "right", color = "black")

Pos_Pcts <- Sedi_pos %>% subset(AnalysisDate >= Start_date & AnalysisDate < End_date) %>% replace(is.na(.), -0.5) %>% dplyr::select(AnalysisDate, contains("OrganicMean")) %>% gt() %>% data_color(columns = contains("OrganicMean"), fn = scales::col_numeric(palette = "plasma", domain = Sedi_pos %>% replace(is.na(.), -0.5) %>% dplyr::select(contains("OrganicMean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>%  gt_add_divider(columns = c(1, 3), sides = "right", color = "black")

Pos_Wts <- Sedi_pos %>% subset(AnalysisDate >= Start_date & AnalysisDate < End_date) %>% replace(is.na(.), -0.1) %>% dplyr::select(AnalysisDate, contains("OrgWtMean")) %>% gt() %>% data_color(columns = contains("OrgWtMean"), fn = scales::col_numeric(palette = "plasma", domain = Sedi_pos %>% replace(is.na(.), -0.1) %>% dplyr::select(contains("OrgWtMean")) %>% unlist() %>% range(na.rm = T))) %>% cols_align(align = c("center"), columns = everything()) %>%  gt_add_divider(columns = c(1, 3), sides = "right", color = "black")
#
#Summary tables 
LWL_sum_tab <- rbind(Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(grepl("LWL", Station)) %>% group_by(Station, Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% dplyr::select(Station, RateMean, PctOrganicMean, OrgWtMean), Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(grepl("LWL", Station)) %>% group_by(Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% mutate(Station = "Mean")) %>% rename("Sedimentation Rate (g/month)" = RateMean, "% Organic" = PctOrganicMean, "Oragnic Weight (g)" = OrgWtMean) %>% ungroup() %>% gt() %>%   tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = c(4))) %>% tab_style(style = cell_borders(sides = c("bottom"), style = "hidden"), locations = cells_body(rows = c(1, 2, 4))) %>% tab_options(heading.title.font.size = "12px", heading.border.bottom.style = "solid", heading.border.bottom.color = "black", table.border.top.style = "hidden", table.font.names = c("Times New Roman"), table.font.size = "12px") %>% cols_align(align = "center") %>% tab_header(title = "Natural reefs") %>% opt_align_table_header(align = "left") %>% gt_add_divider(columns = c(1, 2, 3), sides = "right", color = "black") %>% tab_style(style = cell_borders(sides = "top", color = "black"), locations = cells_body(rows = c(1, 4)))
#
LWR_sum_tab <- rbind(Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(grepl("LWR", Station)) %>% group_by(Station, Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% dplyr::select(Station, RateMean, PctOrganicMean, OrgWtMean), Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(grepl("LWR", Station)) %>% group_by(Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% mutate(Station = "Mean")) %>% rename("Sedimentation Rate (g/month)" = RateMean, "% Organic" = PctOrganicMean, "Oragnic Weight (g)" = OrgWtMean) %>% ungroup() %>% gt() %>%   tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = c(4))) %>% tab_style(style = cell_borders(sides = c("bottom"), style = "hidden"), locations = cells_body(rows = c(1, 2, 4))) %>% tab_options(heading.title.font.size = "12px", heading.border.bottom.style = "solid", heading.border.bottom.color = "black", table.border.top.style = "hidden", table.font.names = c("Times New Roman"), table.font.size = "12px") %>% cols_align(align = "center") %>% tab_header(title = "Restoration reefs") %>% opt_align_table_header(align = "left") %>% gt_add_divider(columns = c(1, 2, 3), sides = "right", color = "black") %>% tab_style(style = cell_borders(sides = "top", color = "black"), locations = cells_body(rows = c(1, 4)))
#
North_sum_tab <- rbind(Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(Position == "North") %>% group_by(Station, Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% dplyr::select(Station, RateMean, PctOrganicMean, OrgWtMean) %>% arrange(factor(Station, levels = c("LWR4", "LWL1", "LWL2"))), Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(Position == "North") %>% group_by(Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% mutate(Station = "Mean")) %>% rename("Sedimentation Rate (g/month)" = RateMean, "% Organic" = PctOrganicMean, "Oragnic Weight (g)" = OrgWtMean) %>% ungroup() %>% gt() %>%   tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = c(4))) %>% tab_style(style = cell_borders(sides = c("bottom"), style = "hidden"), locations = cells_body(rows = c(1, 2, 4))) %>% tab_options(heading.title.font.size = "12px", heading.border.bottom.style = "solid", heading.border.bottom.color = "black", table.border.top.style = "hidden", table.font.names = c("Times New Roman"), table.font.size = "12px") %>% cols_align(align = "center") %>% tab_header(title = "North reefs") %>% opt_align_table_header(align = "left") %>% gt_add_divider(columns = c(1, 2, 3), sides = "right", color = "black") %>% tab_style(style = cell_borders(sides = "top", color = "black"), locations = cells_body(rows = c(1, 4)))
#
South_sum_tab <- rbind(Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(Position == "South") %>% group_by(Station, Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% dplyr::select(Station, RateMean, PctOrganicMean, OrgWtMean) %>% arrange(factor(Station, levels = c("LWR2", "LWR3", "LWL3"))), Reef_type_summ %>% mutate(Station = str_remove(Station, "\\.")) %>% filter(Position == "South") %>% group_by(Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),2)) %>% spread(Measure, meanValue) %>% mutate(Station = "Mean")) %>% rename("Sedimentation Rate (g/month)" = RateMean, "% Organic" = PctOrganicMean, "Oragnic Weight (g)" = OrgWtMean) %>% ungroup() %>% gt() %>%   tab_style(style = cell_text(weight = "bold"), locations = cells_body(rows = c(4))) %>% tab_style(style = cell_borders(sides = c("bottom"), style = "hidden"), locations = cells_body(rows = c(1, 2, 4))) %>% tab_options(heading.title.font.size = "12px", heading.border.bottom.style = "solid", heading.border.bottom.color = "black", table.border.top.style = "hidden", table.font.names = c("Times New Roman"), table.font.size = "12px") %>% cols_align(align = "center") %>% tab_header(title = "South reefs") %>% opt_align_table_header(align = "left") %>% gt_add_divider(columns = c(1, 2, 3), sides = "right", color = "black") %>% tab_style(style = cell_borders(sides = "top", color = "black"), locations = cells_body(rows = c(1, 4)))
```
## Report summary
This data summary was compiled on `r format(Sys.Date(), "%d %B %Y")` and summarizes data for **CERP** and **PBC** quarterly reports from `r format(Start_date, "%B %Y")` through `r format(End_date, "%B %Y")` .\

<h1>`r paste("CERP Quarterly Report")`</h1>
<h2>`r paste("East Coast")`</h2>
<h3> `r paste("Water Quality summary")` </h3>
Minimum and maximum values observed during the quarter and data ordered by increasing values.
`r CERP_Sal %>% tab_caption(caption = "Monthly CERP salinity measurements")`
`r CERP_Sec %>% tab_caption(caption = "Monthly CERP secchi measurements")`

<h3> `r paste("Dermo summary")` </h3>
`r CERP_dermo %>% tab_caption(caption = "Monthly CERP dermo intensity and prevelence")`
<p> Intensity range: `r Dermo_CERP %>% dplyr::select(contains("Mean")) %>% unlist() %>% min()` - `r Dermo_CERP %>% dplyr::select(contains("Mean")) %>% unlist() %>% max()`\
Prevalence range: `r Dermo_CERP %>% dplyr::select(contains("Pct")) %>% unlist() %>% min()` - `r Dermo_CERP %>% dplyr::select(contains("Pct")) %>% unlist() %>% max()` </p>

<h3> `r paste("Recruitment summary")` </h3>
`r CERP_rcrt %>% tab_caption(caption = "Monthly CERP recruitment rates")`
<p> Recruitment range: `r Rcrt_CERP %>% dplyr::select(contains("Mean")) %>% unlist() %>% min()` - `r Rcrt_CERP %>% dplyr::select(contains("Mean")) %>% unlist() %>% max()` </p>

<h3> `r paste("Repro summary")` </h3>
`r CERP_repro %>% tab_caption(caption = "Monthly CERP reproductive stages")`

<h3> `r paste("Survey summary")` </h3>
*Monthly CERP live oyster counts*
`r CERP_count`
Live Counts range: `r Counts_CERP %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("LiveMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Counts_CERP %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("LiveMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`\
*Monthly CERP dead ratios*\
`r CERP_dead`\
<p> DeadRatio range: `r Counts_CERP %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("DeadRatioMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Counts_CERP %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("DeadRatioMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`</p>\
*Monthly CERP shell heights*\
`r CERP_SH`\
<p>Shell height range: `r SH_CERP %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("Mean")) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r SH_CERP %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("Mean")) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()` </p>\

<h3> `r paste("Cage summary")` </h3>
`r SL_Cage %>% tab_caption(caption = "Monthly St. Lucie cage data")`
<p>
Deployed SH Range: `r Cage_CERP %>% dplyr::select(RetDate, contains("SL")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CERP %>% dplyr::select(RetDate, contains("SL")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Retrieved SH Range: `r Cage_CERP %>% dplyr::select(contains("SL")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CERP %>% dplyr::select(contains("SL")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Percent Mortality Range: `r Cage_CERP %>% dplyr::select(RetDate, contains("SL")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CERP %>% dplyr::select(RetDate, contains("SL")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
</p>
`r LX_Cage %>% tab_caption(caption = "Monthly Loxahatchee cage data")`
<p>
Deployed SH Range: `r Cage_CERP %>% dplyr::select(RetDate, contains("LX")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CERP %>% dplyr::select(RetDate, contains("LX")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Retrieved SH Range: `r Cage_CERP %>% dplyr::select(contains("LX")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CERP %>% dplyr::select(contains("LX")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Percent Mortality Range: `r Cage_CERP %>% dplyr::select(RetDate, contains("LX")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CERP %>% dplyr::select(RetDate, contains("LX")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. < 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
</p>

\
<h2>`r paste("West Coast")`</h2>
<h3> `r paste("Water Quality summary")` </h3>
Minimum and maximum values observed during the quarter and data ordered by increasing values.
`r CRE_Sal %>% tab_caption(caption = "Monthly CRE salinity measurements")`
`r CRE_Sec %>% tab_caption(caption = "Monthly CRE secchi measurements")`

<h3> `r paste("Dermo summary")` </h3>
`r CRE_dermo %>% tab_caption(caption = "Monthly CRE dermo intensity and prevelence")`
<p> Intensity range: `r Dermo_CRE %>% dplyr::select(contains("Mean")) %>% unlist() %>% min()` - `r Dermo_CRE %>% dplyr::select(contains("Mean")) %>% unlist() %>% max()`\
Prevalence range: `r Dermo_CRE %>% dplyr::select(contains("Pct")) %>% unlist() %>% min()` - `r Dermo_CRE %>% dplyr::select(contains("Pct")) %>% unlist() %>% max()` </p>

<h3> `r paste("Recruitment summary")` </h3>
`r CRE_rcrt %>% tab_caption(caption = "Monthly CRE recruitment rates")`
<p> Recruitment range: `r Rcrt_CRE %>% dplyr::select(contains("Mean")) %>% unlist() %>% min()` - `r Rcrt_CRE %>% dplyr::select(contains("Mean")) %>% unlist() %>% max()` </p>

<h3> `r paste("Repro summary")` </h3>
`r CRE_repro %>% tab_caption(caption = "Monthly CRE reproductive stages")`

<h3> `r paste("Survey summary")` </h3>
`r CRE_count %>% tab_caption(caption = "Monthly CRE live oyster counts")`
<p> Live Counts range: `r Counts_CRE %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("LiveMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Counts_CRE %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("LiveMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`</p>
`r CRE_dead %>% tab_caption(caption = "Monthly CRE dead ratios")`
<p>DeadRatio range: `r Counts_CRE %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("DeadRatioMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Counts_CRE %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("DeadRatioMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`</p>
`r CRE_SH %>% tab_caption(caption = "Monthly CRE shell heights")`
<p>Shell height range: `r SH_CRE %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("Mean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r SH_CRE %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("Mean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()` </p>

<h3> `r paste("Cage summary")` </h3>
`r CRE_Cage %>% tab_caption(caption = "Monthly CRE-East cage data")`
<p>
Deployed SH Range: `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.E")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.E")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Retrieved SH Range: `r Cage_CRE %>% dplyr::select(contains("CR.E")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CRE %>% dplyr::select(contains("CR.E")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Percent Mortality Range: `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.E")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.E")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
</p>
`r CRW_Cage %>% tab_caption(caption = "Monthly CR-West cage data")`
<p>
Deployed SH Range: `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.W")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.W")) %>% dplyr::select(contains('Dep')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Retrieved SH Range: `r Cage_CRE %>% dplyr::select(contains("CR.W")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CRE %>% dplyr::select(contains("CR.W")) %>% dplyr::select(contains('Ret')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
Percent Mortality Range: `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.W")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Cage_CRE %>% dplyr::select(RetDate, contains("CR.W")) %>% dplyr::select(contains('Pct')) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`
</p>
\
\
<h1>`r paste("PBC Quarterly Report")`</h1>
<h3> `r paste("Water Quality summary")` </h3>
Minimum and maximum values observed during the quarter and data ordered by increasing values.
`r PBC_Sal %>% tab_caption(caption = "Monthly PBC salinity measurements")`
`r PBC_Sec %>% tab_caption(caption = "Monthly PBC secchi measurements")`

<h3> `r paste("Dermo summary")` </h3>
`r PBC_dermo %>% tab_caption(caption = "Monthly PBC dermo intensity and prevelence")`
<p> Intensity range: `r Dermo_PBC %>% dplyr::select(contains("Mean")) %>% unlist() %>% min()` - `r Dermo_PBC %>% dplyr::select(contains("Mean")) %>% unlist() %>% max()`\
Prevalence range: `r Dermo_PBC %>% dplyr::select(contains("Pct")) %>% unlist() %>% min()` - `r Dermo_PBC %>% dplyr::select(contains("Pct")) %>% unlist() %>% max()` </p>
Summary by reef type:
`r Dermo_PBC %>% gather(Info, Value, -RetDate) %>% mutate(Value = na_if(Value, -999), Site = substr(Info, 1, 4), Measure = substr(Info, 7, n())) %>% group_by(Site, Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),3)) %>% spread(Measure, meanValue) %>% rename("Intensity" = Mean) %>% gt()`

<h3> `r paste("Recruitment summary")` </h3>
`r PBC_rcrt %>% tab_caption(caption = "Monthly PBC recruitment rates")`
<p> Recruitment range: `r Rcrt_PBC %>% dplyr::select(contains("Mean")) %>% unlist() %>% min()` - `r Rcrt_PBC %>% dplyr::select(contains("Mean")) %>% unlist() %>% max()` </p>
Summary by reef type:
`r Rcrt_PBC %>% gather(Info, Value, -RetDate) %>% mutate(Value = na_if(Value, -999), Site = substr(Info, 1, 4), Measure = substr(Info, 7, n())) %>% group_by(Site, Measure) %>% summarise(meanValue = round(mean(Value, na.rm = T),3)) %>% spread(Measure, meanValue) %>% gt()`


<h3> `r paste("Repro summary")` </h3>
`r PBC_repro %>% tab_caption(caption = "Monthly PBC reproductive stages")`

<h3> `r paste("Survey summary")` </h3>
`r PBC_count %>% tab_caption(caption = "Monthly PBC live oyster counts")`
<p> Live Counts range: `r Counts_PBC %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("LiveMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Counts_PBC %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("LiveMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`</p>
`r PBC_dead %>% tab_caption(caption = "Monthly PBC dead ratios")`
<p>DeadRatio range: `r Counts_PBC %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("DeadRatioMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r Counts_PBC %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("DeadRatioMean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()`</p>
`r PBC_SH %>% tab_caption(caption = "Monthly PBC shell heights")`
<p>Shell height range: `r SH_PBC %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("Mean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(min_value = min(across(everything()), na.rm = TRUE)) %>% unlist()` - `r SH_PBC %>% filter(AnalysisDate > as.yearmon(Start_date) & AnalysisDate < as.yearmon(End_date %m+% months(1))) %>% dplyr::select(contains("Mean")) %>% mutate(across(where(is.numeric), ~ifelse(. <= 0 | is.na(.), NA, .))) %>% summarise(max_value = max(across(everything()), na.rm = TRUE)) %>% unlist()` </p>
<p>Summary by reef type: 
`r Counts_PBC %>% gather(Info, Value, -AnalysisDate) %>% mutate(Value = na_if(Value, -999), Site = substr(Info, 1, 4), Measure = substr(Info, 7, n())) %>% group_by(Site, Measure) %>% summarise(Mean = round(mean(Value, na.rm = T),3)) %>% spread(Measure, Mean) %>% dplyr::select(Site, LiveMean, DeadRatioMean) %>% gt()`
`r SH_PBC %>% gather(Info, Value, -AnalysisDate) %>% mutate(Value = na_if(Value, -999), Site = substr(Info, 1, 4), SH = substr(Info, 7, n())) %>% group_by(Site, SH) %>% summarise(Mean = round(mean(Value, na.rm = T),3)) %>% spread(SH, Mean) %>% gt()`
<p> Survey summary table: </p>
`r PBC_survey_sum %>% tab_caption(caption = "Survey summary by station")`

<h3> `r paste("Sediment summary")` </h3>
`r Sta_Rates %>% tab_caption(caption = "Monthly sedimentation rate by station")`
*Sedimentation rate range: Overall-*`r Rate_sta %>% dplyr::select(contains("Mean")) %>% unlist() %>% setdiff(., NA) %>% min()` - `r Rate_sta %>% dplyr::select(contains("Mean")) %>% unlist()  %>% setdiff(., NA) %>% max()`
-- -- --*by Site-* 
LWL- `r Rate_sta %>% dplyr::select(contains("LW.L")) %>% unlist() %>% setdiff(., NA) %>% min()` - `r Rate_sta %>% dplyr::select(contains("Lw.L")) %>%  unlist() %>% setdiff(., NA) %>% max()`
-- -- LWR-  `r Rate_sta %>% dplyr::select(contains("LW.R")) %>% unlist() %>% setdiff(., NA) %>% min()` - `r Rate_sta %>% dplyr::select(contains("Lw.R")) %>% unlist() %>% setdiff(., NA) %>% max()`\
*Sedimentation rate mean: Overall-*`r Rate_sta %>% dplyr::select(contains("Mean")) %>% unlist() %>% setdiff(., NA)%>% mean() %>% round(2)`\
*by Site- *`r Rate_sta %>% dplyr::select(contains("Mean")) %>% gather(Info, Value) %>% mutate(Site = substr(Info,  1, 4)) %>% group_by(Site) %>% summarise(mean = round(mean(Value, na.rm = T), 2)) %>% gt()`

`r Sta_Pcts %>% tab_caption(caption = "Monthly sedimentation percent organic by station")`
*Percent organic range: Overall-*`r Pct_sta %>% dplyr::select(contains("Mean")) %>% unlist() %>% setdiff(., NA) %>% min()` - `r Pct_sta %>% dplyr::select(contains("Mean")) %>% unlist()  %>% setdiff(., NA) %>% max()`
-- -- --*by Site-* 
LWL- `r Pct_sta %>% dplyr::select(contains("LW.L")) %>% unlist()  %>% setdiff(., NA) %>% min()` - `r Pct_sta %>% dplyr::select(contains("Lw.L")) %>% unlist() %>% setdiff(., NA) %>% max()`
-- -- LWR-  `r Pct_sta %>% dplyr::select(contains("LW.R")) %>% unlist() %>% setdiff(., NA) %>% min()` - `r Pct_sta %>% dplyr::select(contains("Lw.R")) %>% unlist()  %>% setdiff(., NA) %>% max()`\
*Percent organic mean: Overall-*`r Pct_sta %>% dplyr::select(contains("Mean")) %>% unlist()  %>% setdiff(., NA) %>% mean() %>% round(2)`\
*by Site- *`r Pct_sta %>% dplyr::select(contains("Mean")) %>% gather(Info, Value)  %>% mutate(Site = substr(Info,  1, 4)) %>% group_by(Site) %>% summarise(mean = round(mean(Value, na.rm = T), 2)) %>% gt()`

`r Sta_Wts %>% tab_caption(caption = "Monthly sedimentation organic weights by station")`
*Organic weight range: Overall-*`r Wt_sta %>% dplyr::select(contains("Mean")) %>% unlist() %>% setdiff(., NA) %>% min()` - `r Wt_sta %>% dplyr::select(contains("Mean")) %>% unlist()  %>% setdiff(., NA) %>% max()`
-- -- --*by Site-* 
LWL- `r Wt_sta %>% dplyr::select(contains("LW.L")) %>% unlist()  %>% setdiff(., NA) %>% min()` - `r Wt_sta %>% dplyr::select(contains("Lw.L")) %>% unlist() %>% setdiff(., NA) %>% max()`
-- -- LWR-  `r Wt_sta %>% dplyr::select(contains("LW.R")) %>% unlist() %>% setdiff(., NA) %>% min()` - `r Wt_sta %>% dplyr::select(contains("Lw.R")) %>% unlist()  %>% setdiff(., NA) %>% max()`\
*Organic weight mean: Overall-*`r Wt_sta %>% dplyr::select(contains("Mean")) %>% unlist()  %>% setdiff(., NA) %>% mean() %>% round(2)`\
*by Site- *`r Wt_sta %>% dplyr::select(contains("Mean")) %>% gather(Info, Value)  %>% mutate(Site = substr(Info,  1, 4)) %>% group_by(Site) %>% summarise(mean = round(mean(Value, na.rm = T), 2)) %>% gt()`

`r Pos_Rates %>% tab_caption(caption = "Monthly sedimentation rate by North v South stations")`
`r Pos_Pcts %>% tab_caption(caption = "Monthly sedimentation percent organic by North v South stations")`
`r Pos_Wts %>% tab_caption(caption = "Monthly sedimentation organic weights by North v South stations")`
Sediment trap summary tables:
`r LWL_sum_tab %>% tab_caption(caption = "Mean quarterly sedimentation rate of natural reef stations")`
`r LWR_sum_tab %>% tab_caption(caption = "Mean quarterly sedimentation rate of restoration reef stations")`
`r North_sum_tab %>% tab_caption(caption = "Mean quarterly sedimentation rate on reefs at stations North of C-51")`
`r South_sum_tab %>% tab_caption(caption = "Mean quarterly sedimentation rate on reefs at stations South of C-51")`

\